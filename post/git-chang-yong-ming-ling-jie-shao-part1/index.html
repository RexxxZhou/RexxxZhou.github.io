<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>git常用命令介绍-part1 | Rexxxx&#39;s Blog</title>
<meta name="description" content="Life is a fucking movie, enjoy.">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="shortcut icon" href="https://rexxxzhou.github.io/favicon.ico?v=1678621911113">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="stylesheet" href="https://unpkg.com/papercss@1.6.1/dist/paper.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://rexxxzhou.github.io/styles/main.css">


<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/highlight.min.js"></script>


<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />


  </head>
  <body>
  
    <nav class="navbar border fixed split-nav">
  <div class="nav-brand">
    <h3><a href="https://rexxxzhou.github.io">Rexxxx&#39;s Blog</a></h3>
  </div>
  <div class="collapsible">
    <input id="collapsible1" type="checkbox" name="collapsible1">
    <button>
      <label for="collapsible1">
        <div class="bar1"></div>
        <div class="bar2"></div>
        <div class="bar3"></div>
      </label>
    </button>
    <div class="collapsible-body">
      <ul class="inline">
        
          <li>
            
              <a href="/" class="menu">
                首页
              </a>
            
          </li>
        
          <li>
            
              <a href="/archives" class="menu">
                归档
              </a>
            
          </li>
        
          <li>
            
              <a href="/tags" class="menu">
                标签
              </a>
            
          </li>
        
          <li>
            
              <a href="/post/about" class="menu">
                关于
              </a>
            
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div id="top" class="row site">
      <div class="sm-12 md-8 col">
        <div class="paper">
          <article class="article">
            <h1>git常用命令介绍-part1</h1>
            <p class="article-meta">
              2022-08-28
              
                <a href="https://rexxxzhou.github.io/tag/MF20Z50u8/" class="badge success">
                  git
                </a>
              
            </p>
            
            <div class="post-content" v-pre>
              <h2 id="git创建本地分支推送本地分支到远程库">git创建本地分支，推送本地分支到远程库</h2>
<p>创建本地分支后，应当立刻push到远程库，这样远程库才有新分支的信息，否则后面开发分支管理困难</p>
<pre><code class="language-javascript">git checkout -b new_branch
git push origin new_branch:new_branch // 在远程库对应创建一个分支
</code></pre>
<p>执行上述命令后，后续的git pull和git push都能直接操作，都在自己的分支上开发。</p>
<h2 id="自己在分支a需要同步分支b的更新">自己在分支A，需要同步分支B的更新</h2>
<p>例如自己在开发分支dev，而有时候master分支更新了公共代码，需要同步时，在本地库的操作需要先切换到master分支，pull下最新的代码，然后切回自己的dev分支，将master分支合并到dev分支：</p>
<pre><code class="language-javascript">git checkout master
git pull
git checkout dev
git merge master
</code></pre>
<p>这样，就可以实现代码和别人的修改同步，所以在merge request之前，应当先进行上述操作，保证非自己修改的代码文件和最新的保持一致。</p>
<h2 id="本地代码库回滚">【本地代码库回滚】：</h2>
<p>git reset --hard commit-id :回滚到commit-id，讲commit-id之后提交的commit都去除</p>
<p>git reset --hard HEAD~3：将最近3次的提交回滚</p>
<h2 id="远程代码库回滚">【远程代码库回滚】：</h2>
<p>这个是重点要说的内容，过程比本地回滚要复杂</p>
<p>应用场景：自动部署系统发布后发现问题，需要回滚到某一个commit，再重新发布</p>
<p>原理：先将本地分支退回到某个commit，删除远程分支，再重新push本地分支</p>
<p>操作步骤：</p>
<p>1、git checkout the_branch<br>
2、git pull<br>
3、git branch the_branch_backup //备份一下这个分支当前的情况<br>
4、git reset --hard the_commit_id //把the_branch本地回滚到the_commit_id<br>
5、git push origin :the_branch //删除远程 the_branch<br>
6、git push origin the_branch //用回滚后的本地分支重新建立远程分支<br>
7、git push origin :the_branch_backup //如果前面都成功了，删除这个备份分支</p>
<h3 id="方法一">方法一：</h3>
<p>1、新建backup分支 作为备份，以防万一<br>
git branch backup</p>
<p>2、将本地的backup分支　推送到远程的backup<br>
git push origin backup:backup</p>
<p>3、本地仓库彻底回退到xxxxx版本，xxxxx版本之后的commit信息将丢失</p>
<p>git reset --hard xxxxx</p>
<p>4、删除远程的master分支 (注意master前有个:)<br>
git push origin :master</p>
<p>主要远程仓库的master如果是保护分支将报错，请去掉对分支的保护设置：<br>
remote: GitLab: You are  allowed  to  deleted protected branches from this project. To http://gitlab.mogujie.org/shihao/afanty.git ! [remote rejected] master (pre-receive hook declined) error: failed to push some refs to 'http://gitlab.mogujie.org/xxxx/xxxx.git'</p>
<p>5、重新创建远程master分支(这跟第１次提交本地代码库给远程仓库的命令一样)<br>
git push origin master</p>
<h3 id="方法二">方法二：</h3>
<p>1、本地代码回滚到上一版本（或者指定版本）<br>
git reset --hard HEAD~1</p>
<p>2、加入-f参数，强制提交，远程端将强制跟新到reset版本<br>
git push -f</p>
<p>更详细的代码库回滚方法：</p>
<p>https://zhuanlan.zhihu.com/p/56843134</p>
<h2 id="git-diff两个分支">git diff两个分支</h2>
<pre><code class="language-javascript">Git diff branch1 branch2 --stat   //显示出所有有差异的文件列表

Git diff branch1 branch2 文件名(带路径)   //显示指定文件的详细差异

Git diff branch1 branch2                   //显示出所有有差异的文件的详细差异
</code></pre>
<h2 id="git解决合并的冲突">git解决合并的冲突</h2>
<p>https://www.liaoxuefeng.com/wiki/896043488029600/900004111093344</p>
<p>冲突场景，本地在自己的分支修改了文件A，同事也修改了文件A并push到master远程分支，为了同步同事的修改，本地checkout master，git pull，checkout my_dev，git merge master时出现冲突，合并失败，在vscode中可以看到文件冲突的内容。</p>
<p>形如：</p>
<figure data-type="image" tabindex="1"><img src="https://s2.loli.net/2022/08/28/3GrIjpetKg2dQnW.png" alt="" loading="lazy"></figure>
<p>在vscode中可以选择接受要合并的分支内容还是自己本地的内容，最好的方法，防止出问题，就是把自己的代码先复制好，然后accept incoming changes，然后在粘贴回自己的代码。</p>
<p>这样就算是解决一个冲突，对每个冲突都处理之后，然后本地git add 这些冲突的文件，git commit -m &quot;fix conflict&quot;就完成了这次merge。要注意commit之后就不需要再merge了，因为merge发生冲突的时候是应把冲突文件以外的文件都合并好了，我们只需要解决冲突然后本地commit就好。</p>
<p>在发生冲突时，git status也可以看本次merge的情况，有哪些文件已经merge好，哪些文件是冲突的。</p>
<p>https://www.cnblogs.com/lsgxeva/p/9485707.html</p>
<h2 id="拉取他人分支">拉取他人分支</h2>
<p>例如别人远程分支是dev2，你的本地分支是my_dev，没有关联到这个分支</p>
<p>最简单的办法就是创建一个新分支，然后关联dev2，pull下来之后再合并到my_dev</p>
<p>可能有更好的做法，可以继续学习</p>
<h2 id="git-fetch-和git-pull">git fetch 和git pull</h2>
<p>使用结果上，git fetch + git merge == git pull</p>
<p>git pull会自动拉取远程仓库中最新的代码并且自动合并，例如会常见到fast-forward</p>
<p>而git fetch则是将代码拉到本地，不执行合并，这样更安全，用户需要手动合并，合并的时候就会知道有哪些地方冲突了。</p>
<p>最直白的使用方式，假设同事A在远程库有自己的分支dev_A，而你的分支在dev_B，他有新的更新，并且你想在本地仓库合并他的代码，那么：</p>
<pre><code class="language-javascript">git fetch origin dev_A:dev_A_local
git checkout dev_B
git merge dev_A_local
</code></pre>
<p>第一行代码会fetch远程的dev_A分支，并和本地的dev_A_local分支关联，如果dev_A_local不存在，就会自动创建一个新分支，如果存在，则会自动合并。然后就执行正常的合并操作，合并到自己的分支。</p>
<figure data-type="image" tabindex="2"><img src="https://s2.loli.net/2022/08/28/TXdS6Ww1NemDIfi.png" alt="" loading="lazy"></figure>
<p>https://www.cnblogs.com/lsgxeva/p/9485707.html</p>
<p>上面的链接讲了git常用的操作 十分详细</p>
<p>包括本地分支和远程分支关联等等操作</p>
<h2 id="本地没有某个分支拉取远端库的分支">本地没有某个分支，拉取远端库的分支</h2>
<p>首先要git pull一下，让本地知道远端有新的分支，更新分支信息</p>
<p>然后</p>
<p>git checkout -b ck_dev origin/ck_dev</p>
<p>origin/ck_dev是远端的分支，这个命令会自动在本地创建分支ck_dev，并切换过去，同时绑定了远端的ck_dev分支，pull和push操作都和这个远端分支关联</p>
<h2 id="gitignore不生效的原因">gitignore不生效的原因</h2>
<figure data-type="image" tabindex="3"><img src="G:/youdaoyun-export/youdaonote-pull/export_files/youdaonote-images/WEBRESOURCEa23880a84d4c84e00bcc1b2536563f34.png" alt="" loading="lazy"></figure>
<p>一定要求文件是没有被tracked才可以。</p>
<figure data-type="image" tabindex="4"><img src="https://s2.loli.net/2022/08/28/RXQqTWOzYeFNSpB.png" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="5"><img src="https://s2.loli.net/2022/08/28/j3da9C6LMmrJ7np.png" alt="" loading="lazy"></figure>
<p>正确的做法：</p>
<p>git rm --cached file_name  // git rm -r --cached dir_name</p>
<p>git commit -m &quot;rm no need file&quot;</p>
<p>git push</p>
<p>https://segmentfault.com/q/1010000000430426</p>
<p>https://shiyousan.com/post/636470505667009340</p>
<p>https://zhuanlan.zhihu.com/p/102890728</p>
<h2 id="当前分支有修改想要切换分支">当前分支有修改，想要切换分支</h2>
<p>如果不在当前分支commit，直接checkout的话，会把当前的修改一起带到新的分支，可以理解成整个分支的文件状态都会移到新分支。</p>
<p>可能当前分支的代码还没有开发完，要切去别的分之，不想这么多次commit，那么可以使用stash命令。</p>
<p>https://www.cnblogs.com/tocy/p/git-stash-reference.html</p>
<p>最简单的情况就是使用git stash，能够保存当前的状态，又不会增加commit的次数，stash之后，checkout到新分支不会带上现有的修改，并且回到原分支之后，可以使用git stash pop来恢复，使得git status能看到stash前的git变更。</p>
<p>更详细的可以看上面的url。</p>
<h2 id="本地-远端版本回退">本地、远端版本回退</h2>
<p>本地回退：</p>
<p>git relog找到commit的标识符</p>
<p>git reset --hard 标识符</p>
<p>远端回退：</p>
<p>在操作了本地回退之后，执行：</p>
<p>git push -f origin branch_name即可</p>
<h2 id="diff">diff</h2>
<p>git diff hash1 hash2</p>
<p>git diff hash1 hash2 -- filename</p>
<p>hash1/2是commit的标签值</p>
<h2 id="git-submodule">git submodule</h2>
<p>https://git-scm.com/book/zh/v2/Git-%E5%B7%A5%E5%85%B7-%E5%AD%90%E6%A8%A1%E5%9D%97</p>
<p>git Submodule 是一个很好的多项目使用共同类库的工具，他允许类库项目做为repository,子项目做为一个单独的git项目存在父项目中，子项目可以有自己的独立的commit，push，pull。而父项目以Submodule的形式包含子项目，父项目可以指定子项目header，父项目中会的提交信息包含Submodule的信息，再clone父项目的时候可以把Submodule初始化。</p>
<p>https://segmentfault.com/a/1190000003076028</p>
<p>git submodule add git@github.com:jjz/pod-library.git pod-library</p>
<p>git submodule add后面可以直接给子模块repo的地址</p>
<p>在Submodule的目录中,使用git和单独的一个项目是一样的,注意更新Submodule的时候如果有新的commit id产生，需要在父项目产生一个新的提交，pod-libray文件中的 Subproject commit会变为最新的commit id。</p>
<p>父项目是有自己的git信息，子模块有自己的git信息，两个是独立的，我们进入子模块的目录，修改文件，再push，就会对子模块的git repo进行更新，此时需要回到父模块目录下，git add git commit来更新子模块信息的变更。</p>
<figure data-type="image" tabindex="6"><img src="https://s2.loli.net/2022/08/28/AxzSOFiGqoJ3kyT.png" alt="" loading="lazy"></figure>
<h2 id="git-tag">git tag</h2>
<p>打标签，等价于给一个commit起别名、引用，方便我们在某一天需要切换到该分支进行开发的时候，能够快速切换，并且还能基于这个分支创建新的bugfix分支。</p>
<p>https://git-scm.com/book/zh/v2/Git-%E5%9F%BA%E7%A1%80-%E6%89%93%E6%A0%87%E7%AD%BE</p>
<p>git tag -l 或 git tag</p>
<p>可以查看现在repo下的所有tag</p>
<p>git tag -l &quot;tag_name*&quot; 可以正则匹配查看符合条件的tag</p>
<p>tag分两类，一类是轻量tag，一类是附注tag（annotation）</p>
<p>附注tag会带上创建人的所有信息，包含打标签者的名字、电子邮件地址、日期时间， 此外还有一个标签信息，并且可以使用 GNU Privacy Guard （GPG）签名并验证。 通常会建议创建附注标签。</p>
<pre><code class="language-javascript">git tag -a v1.4 -m &quot;tag version v1.4&quot;
# -a 就是附注tag的意思
</code></pre>
<figure data-type="image" tabindex="7"><img src="https://s2.loli.net/2022/08/28/49Izu7Hdc1WgFmT.png" alt="" loading="lazy"></figure>
<p>轻量标签，不需要-a -m 的选项，直接打</p>
<pre><code class="language-javascript">git tag v1.4
</code></pre>
<figure data-type="image" tabindex="8"><img src="https://s2.loli.net/2022/08/28/1RJPzOpYAHSCgel.png" alt="" loading="lazy"></figure>
<p>如果以前的提交没打过标签，想补打，也是可以的</p>
<figure data-type="image" tabindex="9"><img src="https://s2.loli.net/2022/08/28/gopzuGEnbD1lqja.png" alt="" loading="lazy"></figure>
<pre><code class="language-javascript">git tag -a v1.2 commit_id
</code></pre>
<p>推送标签，git tag执行完只在本地生成了tag，需要推送到远端，共享，则执行下面的命令：</p>
<pre><code class="language-javascript">git push origin v1.4
</code></pre>
<p>如果不想每次都输入tag name，想一次全部推送，则</p>
<pre><code class="language-javascript">git push origin --tags
</code></pre>
<p>删除标签，本地</p>
<pre><code class="language-javascript">git tag -d tag_name
</code></pre>
<p>远端删除标签</p>
<pre><code class="language-javascript">git push origin --delete tagname
</code></pre>
<p>从标签切出新的开发分支</p>
<pre><code class="language-javascript">git checkout -b new_version v1.4
</code></pre>
<p>这时候创建了新的分支new_version，可以在这个分支上开发，实现快速切到某一commit的继续开发</p>
<figure data-type="image" tabindex="10"><img src="https://s2.loli.net/2022/08/28/rOmc15DnMlIqsgU.png" alt="" loading="lazy"></figure>
<h2 id="关联远程仓库">关联远程仓库</h2>
<p>git 配置ssh 这里不说了</p>
<p>在本地目录下 执行 git init 创建本地git仓库</p>
<p>在远程创建好一个仓库后 执行</p>
<p>git add remote origin 仓库地址</p>
<p>完成关联，随后推送分之</p>
<p>git push --set-upstream origin master</p>
<p>完成第一次推送，后续直接git push完事（推送前注意分支）</p>

            </div>
          </article>
        </div>
        <div class="paper" data-aos="fade-in">
          
            <div class="next-post">
              <div class="next">
                下一篇
              </div>
              <a href="https://rexxxzhou.github.io/post/makefile-ji-chu/">
                <h3 class="post-title">
                  makefile基础
                </h3>
              </a>
            </div>
          
        </div>
        
      </div>

      <div class="sm-12 md-4 col sidebar">
  <div class="paper info-container">
    <img src="https://rexxxzhou.github.io/images/avatar.png?v=1678621911113" class="no-responsive avatar">
    <div class="text-muted">Life is a fucking movie, enjoy.</div>
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
  </div>
  <div class="paper">
    <div class="sidebar-title">
      最新文章
    </div>
    <div class="row">
      <ul>
        
          
            <li>
              <a href="https://rexxxzhou.github.io/post/effectivego-bi-ji/">EffectiveGo笔记</a>
            </li>
          
        
          
            <li>
              <a href="https://rexxxzhou.github.io/post/go-yu-yan-wang-luo-kai-fa/">Go语言网络开发</a>
            </li>
          
        
          
            <li>
              <a href="https://rexxxzhou.github.io/post/go-yu-yan-shu-zu-yu-qie-pian/">Go语言数组与切片</a>
            </li>
          
        
          
            <li>
              <a href="https://rexxxzhou.github.io/post/go-yu-yan-lei-xing/">Go语言类型</a>
            </li>
          
        
          
            <li>
              <a href="https://rexxxzhou.github.io/post/go-yu-yan-kong-zhi-liu/">Go语言控制流</a>
            </li>
          
        
          
            <li>
              <a href="https://rexxxzhou.github.io/post/go-yu-yan-ji-chu-zhi-shi/">Go语言基础知识</a>
            </li>
          
        
          
            <li>
              <a href="https://rexxxzhou.github.io/post/go-yu-yan-han-shu/">Go语言函数</a>
            </li>
          
        
          
            <li>
              <a href="https://rexxxzhou.github.io/post/go-yu-yan-de-yi-xie-nei-zhi-han-shu/">Go语言的一些内置函数</a>
            </li>
          
        
          
            <li>
              <a href="https://rexxxzhou.github.io/post/go-yu-yan-cuo-wu-chu-li/">Go语言错误处理</a>
            </li>
          
        
          
            <li>
              <a href="https://rexxxzhou.github.io/post/go-yu-yan-bing-fa/">Go语言并发</a>
            </li>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </ul>
    </div>
  </div>
  <div class="paper">
    <div class="sidebar-title">
      标签列表
    </div>
    <div class="row">
      
        <a href="https://rexxxzhou.github.io/tag/bzcKfnF8X/" class="badge warning">
          Golang
        </a>
      
        <a href="https://rexxxzhou.github.io/tag/Jnf5LaxTP/" class="badge warning">
          apue读书笔记
        </a>
      
        <a href="https://rexxxzhou.github.io/tag/hPjfg7vfX/" class="badge success">
          python
        </a>
      
        <a href="https://rexxxzhou.github.io/tag/fOn--vI2w/" class="badge warning">
          日常开发知识沉淀
        </a>
      
        <a href="https://rexxxzhou.github.io/tag/ESBJ9vM7t/" class="badge secondary">
          apisix
        </a>
      
        <a href="https://rexxxzhou.github.io/tag/R9r12TtWy/" class="badge secondary">
          lua
        </a>
      
        <a href="https://rexxxzhou.github.io/tag/MF20Z50u8/" class="badge warning">
          git
        </a>
      
        <a href="https://rexxxzhou.github.io/tag/e43sinOSt/" class="badge success">
          MySQL
        </a>
      
        <a href="https://rexxxzhou.github.io/tag/m7J2bceGd/" class="badge ">
          HTTP
        </a>
      
        <a href="https://rexxxzhou.github.io/tag/m3a3xDoDi/" class="badge warning">
          ElasticSearch
        </a>
      
    </div>
  </div>
  <div class="paper">
    Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://rexxxzhou.github.io/atom.xml" target="_blank">RSS</a>
  </div>
</div>


    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>

<script type="application/javascript">

AOS.init();

hljs.initHighlightingOnLoad()

</script>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5746490084885111"
     crossorigin="anonymous"></script>




  </body>
</html>
